import{r as n,j as h,a as e,F as D}from"./index-cd6013e8.js";function re({data:l,index:c,courseUpdate:u}){const[d,a]=n.useState(l[0]),[m,C]=n.useState(l[1]),[y,b]=n.useState(l[2]);return n.useEffect(()=>{u(c,[d,m,y])},[d,m,y,u,c]),h("div",{className:"course",children:[e("input",{type:"text",onBlur:t=>a(t.currentTarget.value.trim().toUpperCase()),defaultValue:d,placeholder:"course",required:!0}),e("input",{type:"number",onBlur:t=>{const s=t.currentTarget.value.trim();C(s===""?0:parseInt(s))},defaultValue:m===0?"":m,placeholder:"unit",pattern:"[1-9]{1,2}",title:"Only one or two digit(s) are allowed",required:!0}),e("input",{type:"number",onBlur:t=>{const s=t.currentTarget.value.trim();b(s===""?0:parseInt(s))},defaultValue:y===0?"":y,placeholder:"pass",pattern:"[0-9]{2}",title:"Only two digits are allowed",required:!0})]})}let O;function P(){if(document.body.classList.contains("no-overflow")){document.body.classList.remove("no-overflow"),document.body.style.top="",window.scroll(0,O||0);return}O=window.scrollY,document.body.classList.add("no-overflow"),document.body.style.top="-"+O+"px"}function ne(l,c){const u=[];for(let d=0;d<c.length;d+=l)u.push(c.slice(d,d+l));return u}function se(l,c,u){let d=l.match(/(EL|NIL|AB)/i);if(d)return[d[0],0];const a=parseInt(l);return a<40||a<u?[a+"F",0*c]:a<=44?[a+"E",1*c]:a<=49?[a+"D",2*c]:a<=59?[a+"C",3*c]:a<=69?[a+"B",4*c]:[a+"A",5*c]}function le(l,c){const u=c.map((t,s)=>l[s]!=="EL"?t[1]:0),d=c.map((t,s)=>l[s]!=="EL"?t[2]:0),a=[],m=l.map((t,s)=>se(t,u[s],d[s])).reduce((t,s)=>(a.push(s[0]),t+=s[1],t),0),C=u.reduce((t,s)=>(t+=s,t),0),y=u.filter((t,s)=>t!==0&&(/(NIL|AB)/i.test(l[s])||parseInt(l[s])<d[s])).reduce((t,s)=>(t+=s,t),0),b=Number(m/C).toFixed(2);return{gradedScores:a,calcScores:[C,C-y,y,m,b].map(t=>t.toString())}}function ae(l,c,u){var d;try{if(!l)return;const a=document.createRange();a.selectNodeContents(l);const m=window.getSelection();m==null||m.removeAllRanges(),m==null||m.addRange(a),document.execCommand("copy")&&c&&c(),(d=window.getSelection())==null||d.removeAllRanges()}catch(a){console.error(a),u&&u(a)}}function oe(l,c){return(new Date().getTime()-l)/6e4>c}var T=(l=>(l.alert="alert",l.confirm="confirm",l.prompt="prompt",l))(T||{});function I({info:l,type:c,callbackOk:u,callbackCancel:d}){const[a,m]=n.useState(""),C=n.useRef(null),y=n.useRef(null),b=n.useRef(null),t=n.useRef(null),[s,k]=n.useState(void 0),x=n.useCallback(g=>{var R;if(!(g.key!=="Enter"&&g.currentTarget!==C.current)){if(c==="prompt"&&a==="")return(R=b.current)==null?void 0:R.focus();u(a)}},[u,a,c]),N=n.useCallback(g=>{d&&(g.key==="Escape"||g.currentTarget===y.current)&&d()},[d]);return n.useEffect(()=>{var g;return P(),k((g=t.current)==null?void 0:g.clientHeight),document.addEventListener("keydown",N),document.addEventListener("keydown",x),()=>{P(),k(void 0),document.removeEventListener("keydown",N),document.removeEventListener("keydown",x)}},[N,x]),e("div",{role:"dialog",className:"modal dark dialog",children:e("div",{className:"modal-content",ref:t,style:s&&s>130?{"--c-height":s+"px"}:void 0,children:h("div",{className:"modal-body p-10",children:[e("div",{className:"p-tb-10 p-lr-10",children:c==="prompt"?h(D,{children:[e("label",{htmlFor:"promptInput",children:l}),e("input",{type:"number",id:"promptInput",className:"m-t-10",title:"Only numeral(s) are allowed",placeholder:"Enter number of courses",style:{padding:"8px"},ref:b,onInput:g=>m(g.currentTarget.value.trim()),autoFocus:!0})]}):e("p",{children:l})}),h("div",{className:"flex align-items-center justify-content-end flex-wrap m-tb-10 p-lr-10",children:[c!=="alert"&&e("button",{className:"m-r-10",type:"button",ref:y,onClick:N,children:"Cancel"}),e("button",{type:"button",ref:C,onClick:x,autoFocus:c!=="prompt",children:"Ok"})]})]})})})}function ie({clearBodyStyles:l}){const[c,u]=n.useState(null),[d,a]=n.useState(!1),[m,C]=n.useState(!1),[y,b]=n.useState(!1),[t,s]=n.useState(null),[k,x]=n.useState(""),N=n.useRef(null),[g,R]=n.useState(!1),U=n.useRef(3),M=n.useRef(5),[j,B]=n.useState(null),V=n.useRef(null),[G,A]=n.useState(null),[J,H]=n.useState(!1),[$,E]=n.useState(!1),[W,z]=n.useState(!1);n.useEffect(()=>{l(),s(_())},[l]),n.useEffect(()=>{(!t||t.length<=0)&&(R(!1),A(null))},[t]);const _=()=>{let r=window.localStorage.getItem("courses");return r?JSON.parse(r):null},K=n.useCallback(r=>{if(a(!1),!/^\d+$/.test(r))return setTimeout(()=>u("Please enter a valid numeral."),50);const i=[];for(let w=0;w<parseInt(r);w++)i.push(["",0,40]);const o=(t||[]).concat(i);s(o),window.localStorage.setItem("courses",JSON.stringify(o))},[t]),Q=n.useCallback(()=>{C(!1),window.localStorage.removeItem("courses"),s(null)},[]),X=n.useCallback((r,i)=>{const o=t||_()||[],w=o.findIndex((v,f)=>f===r);w!==-1&&(o[w]=i,window.localStorage.setItem("courses",JSON.stringify(o)),s(o))},[t]),Z=n.useCallback(()=>{try{if(b(!1),!t||t.length<=0)throw new Error("Oops, please add course(s) to continue.");const r=[],i=ne(U.current+t.length,j||[]).map(f=>(r.push(f.splice(0,U.current)),f));if(i.length<=0||i.some(f=>f.length!==t.length))throw new Error("Oops, invalid result sheet format.");const o=[],w=[];i.forEach(f=>{const{gradedScores:p,calcScores:S}=le(f,t);o.push(p),w.push(S)});const v=r.map((f,p)=>f.concat(o[p],w[p]));A(v),setTimeout(()=>{var f;return(f=V.current)==null?void 0:f.scrollIntoView({block:"start"})},50)}catch(r){setTimeout(()=>u(r.message),50)}},[j,t]),ee=n.useCallback(r=>{try{if(r.preventDefault(),A(null),B(null),!/\t/.test(k))throw new Error("Ooops, it appears that result data is not a spreadsheet.");let i=k.split(/(\t|\n)/).map(p=>p.replace(/(\\t|\\n)/g," ")).map(p=>p.trim()).filter(p=>p!=="").reduce((p,S)=>(/^(\d{1,3}[A-F]+)$/i.test(S)&&(S=S.replace(/[A-F]/gi,"")),p.push(S),p),[]);const o=i.findIndex(p=>p.toLowerCase().replace(/\./g,"")==="gpa");if(o===-1)throw new Error("Oops, invalid result data format.");const w=i.splice(0,o+1),v=w.slice(U.current,w.length-M.current),f=i.splice(0,v.length).map(p=>parseInt(p)).map(p=>isNaN(p)?0:p);if(B(i),!g){s(null);const p=[];for(let L=0;L<v.length;L++)p.push([v[L],f[L],40]);const S=[].concat(p);setTimeout(()=>{s(S),window.localStorage.setItem("courses",JSON.stringify(S))},50)}b(!0)}catch(i){u(i.message)}},[k,g]),te=async()=>{if("caches"in window&&"serviceWorker"in navigator)try{E(!1),z(!0),P();const r=await caches.keys();await Promise.all(r.map(v=>caches.delete(v))),(await navigator.serviceWorker.getRegistrations()).forEach(async v=>{var f;(f=v.active)!=null&&f.scriptURL.includes("/gpcalc/")&&await v.unregister()});const o=q(),w={appVersion:(o==null?void 0:o.appVersion)||"",cacheVersion:(o==null?void 0:o.cacheVersion)||new Date().getTime(),lastCheck:(o==null?void 0:o.lastCheck)||new Date().getTime(),hasUpdate:!1};window.localStorage.setItem("updateData",JSON.stringify(w)),window.location.reload()}catch(r){console.error("Update error:",r)}},q=()=>{const r=window.localStorage.getItem("updateData");return r?JSON.parse(r):null},Y=async r=>{let i=null;try{const o=await(await fetch(`./version.json?${new Date().getTime()}`)).json();i={appVersion:o.app,cacheVersion:o.cache,lastCheck:new Date().getTime(),hasUpdate:r!=null&&r.cacheVersion?o.cache>r.cacheVersion:!0},window.localStorage.setItem("updateData",JSON.stringify(i))}catch(o){console.log(o)}return i},F=n.useCallback(async()=>{let r=q()||await Y(null);if(r){if(r!=null&&r.hasUpdate){E(!0);return}oe(r.lastCheck,60)&&(r=await Y(r),!r)||E(r.hasUpdate)}},[]);return n.useEffect(()=>(navigator.onLine&&F(),window.addEventListener("online",F),()=>{window.removeEventListener("online",F)}),[]),h(D,{children:[e("header",{children:e("nav",{className:"doc-width p-tb-10 p-lr-20 flex justify-content-between align-items-center",children:e("h1",{children:"GPCALC"})})}),e("main",{className:"p-tb-20 main-section",children:h("div",{className:"doc-width p-lr-20",children:[h("div",{className:"m-t-10 p-10 --warning",children:[h("p",{children:[e("strong",{style:{fontSize:"16px"},children:"Note: "}),e("span",{children:"For accuracy and performant calculation, use the following format;"})]}),h("ul",{className:"m-t-10",style:{paddingLeft:"20px"},children:[e("li",{children:"Do not leave any score column empty"}),e("li",{children:"Use EL (ie. elective) in place of score for a course the student does/did not offer"}),e("li",{children:"You can also use NIL in place of 0 (zero)"}),e("li",{children:"Use AB (ie. absent) for an absentee"}),h("li",{children:[e("a",{href:"composite-result-template.xlsx",target:"_blank",rel:"noreferrer",children:"Click here"}),e("span",{children:" to download a sample of a result sheet."})]})]})]}),h("div",{className:"p-tb-10 flex justify-content-end m-t-20",children:[e("button",{className:"p-10 m-r-10",onClick:()=>C(!0),disabled:!(t&&t.length>0),children:"Clear Courses"}),e("button",{className:"p-10",onClick:()=>a(!0),children:"Add Courses"})]}),h("form",{onSubmit:ee,children:[h("div",{className:"p-tb-10",children:[e("h3",{children:"Courses"}),e("div",{className:"flex flex-wrap",children:t?t==null?void 0:t.map((r,i)=>e(re,{data:r,index:i,courseUpdate:X},i)):e("p",{style:{marginTop:"10px",textAlign:"left"},children:'Course(s) are automatically added, optionally you can use the "Add Courses" button to manually add course(s).'})})]}),e("div",{className:"selector m-t-20",children:h("div",{className:"selector-elems",children:[e("label",{htmlFor:"resultTable",children:e("h3",{children:"Result sheet"})}),h("div",{className:"m-t-10",style:{position:"relative"},children:[k!==""&&e("button",{type:"button",style:{backgroundColor:"rgba(68, 68, 68, 0.4)",color:"#fff",position:"absolute",top:"10px",right:"10px",padding:"5px 10px",border:"none"},onClick:()=>{x(""),N.current&&(N.current.value="")},children:"Clear"}),e("textarea",{className:"p-10",cols:30,rows:10,id:"resultTable",placeholder:"Paste result spreadsheet here",onInput:r=>x(r.currentTarget.value.trim()),ref:N,required:!0})]}),t&&t.length>0&&e("div",{className:"m-t-10",children:h("label",{children:[e("input",{type:"checkbox",className:"m-r-10",onChange:()=>R(!g),checked:g}),e("span",{style:{userSelect:"none"},children:"Use existing added courses"})]})}),e("div",{className:"flex flex-wrap align-items-center --flex",style:{marginTop:"30px"},children:e("button",{type:"submit",className:"p-10 m-r-10",children:"Calculate"})})]})})]}),e("div",{className:"text-center m-t-20 p-tb-20",ref:V,children:G?h(D,{children:[h("div",{className:"flex justify-content-end flex-wrap",children:[e("button",{className:"p-5 p-lr-10",style:{marginRight:"10px"},onClick:()=>{var r;return ae((r=V.current)==null?void 0:r.children[1],()=>{H(!0),setTimeout(()=>{H(!1)},3*1e3)},()=>u("Copy command failed, please try using native method."))},disabled:J,children:J?"Copied":"Copy"}),e("button",{className:"p-5 p-lr-10",onClick:()=>A(null),children:"Clear"})]}),e("div",{className:"--result-table-wrap p-tb-10",children:h("table",{children:[h("thead",{children:[h("tr",{children:[e("th",{rowSpan:2,children:"S/N"}),e("th",{rowSpan:2,children:"SCHOLAR’S NAME"}),e("th",{rowSpan:2,children:"MATRIC NO"}),t==null?void 0:t.map((r,i)=>e("th",{children:r[0]},i)),e("th",{rowSpan:2,children:"TOTAL UNITS"}),e("th",{rowSpan:2,children:"UNITS PASSED"}),e("th",{rowSpan:2,children:"CARRY OVER UNITS"}),e("th",{rowSpan:2,children:"GP"}),e("th",{rowSpan:2,children:"GPA"})]}),e("tr",{children:t==null?void 0:t.map((r,i)=>e("th",{children:r[1]},i))})]}),e("tbody",{children:G.map((r,i)=>e("tr",{children:r.map((o,w)=>e("td",{children:o},w))},i))})]})})]}):"Calculated result will appear here..."})]})}),e("footer",{children:h("div",{className:"text-center doc-width p-lr-10",children:[h("span",{children:["©"," "+new Date().getFullYear()+" "]}),e("a",{href:"https://24cipher.xyz?ref=gpcalc",target:"_blank",rel:"noreferrer",children:"24Cipher Labs"}),e("span",{children:" Software License & Usage."})]})}),d&&e(I,{info:"How many courses do you want to add?",type:T.prompt,callbackOk:K,callbackCancel:()=>a(!1)}),c&&e(I,{info:c,type:T.alert,callbackOk:()=>u(null)}),m&&e(I,{info:"Are you sure you want to clear courses?",type:T.confirm,callbackOk:Q,callbackCancel:()=>C(!1)}),y&&e(I,{info:"Do you want to continue without reviewing added courses?",type:T.confirm,callbackOk:Z,callbackCancel:()=>b(!1)}),$&&e(I,{info:'Update is available, click "Ok" to continue.',type:T.confirm,callbackOk:te,callbackCancel:()=>E(!1)}),W&&e("div",{role:"dialog",className:"modal",style:{backgroundColor:"#fff"},children:e("div",{className:"modal-content",children:e("p",{style:{textAlign:"center",padding:"20px"},children:"Downloading update, please wait..."})})})]})}export{ie as default};
