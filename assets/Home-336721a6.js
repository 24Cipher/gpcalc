import{r as n,j as h,a as e,F}from"./index-9b10d498.js";function re({data:a,index:o,courseUpdate:u}){const[d,s]=n.useState(a[0]),[m,C]=n.useState(a[1]),[v,y]=n.useState(a[2]);return n.useEffect(()=>{u(o,[d,m,v])},[d,m,v,u,o]),h("div",{className:"course",children:[e("input",{type:"text",onBlur:t=>s(t.currentTarget.value.trim().toUpperCase()),defaultValue:d,placeholder:"course",required:!0}),e("input",{type:"number",onBlur:t=>{const l=t.currentTarget.value.trim();C(l===""?0:parseInt(l))},defaultValue:m===0?"":m,placeholder:"unit",pattern:"[1-9]{1,2}",title:"Only one or two digit(s) are allowed",required:!0}),e("input",{type:"number",onBlur:t=>{const l=t.currentTarget.value.trim();y(l===""?0:parseInt(l))},defaultValue:v===0?"":v,placeholder:"pass",pattern:"[0-9]{2}",title:"Only two digits are allowed",required:!0})]})}let O;function V(){if(document.body.classList.contains("no-overflow")){document.body.classList.remove("no-overflow"),document.body.style.top="",window.scroll(0,O||0);return}O=window.scrollY,document.body.classList.add("no-overflow"),document.body.style.top="-"+O+"px"}function ne(a,o){const u=[];for(let d=0;d<o.length;d+=a)u.push(o.slice(d,d+a));return u}function le(a,o,u){let d=a.match(/(EL|NIL|AB)/i);if(d)return[d[0],0];const s=parseInt(a);return s<40||s<u?[s+"F",0*o]:s<=44?[s+"E",1*o]:s<=49?[s+"D",2*o]:s<=59?[s+"C",3*o]:s<=69?[s+"B",4*o]:[s+"A",5*o]}function ae(a,o){const u=o.map((t,l)=>a[l]!=="EL"?t[1]:0),d=o.map((t,l)=>a[l]!=="EL"?t[2]:0),s=[],m=a.map((t,l)=>le(t,u[l],d[l])).reduce((t,l)=>(s.push(l[0]),t+=l[1],t),0),C=u.reduce((t,l)=>(t+=l,t),0),v=u.filter((t,l)=>t!==0&&(/(NIL|AB)/i.test(a[l])||parseInt(a[l])<d[l])).reduce((t,l)=>(t+=l,t),0),y=Number(m/C).toFixed(2);return{gradedScores:s,calcScores:[C,C-v,v,m,y].map(t=>t.toString())}}function se(a,o,u){var d;try{if(!a)return;const s=document.createRange();s.selectNodeContents(a);const m=window.getSelection();m==null||m.removeAllRanges(),m==null||m.addRange(s),document.execCommand("copy")&&o&&o(),(d=window.getSelection())==null||d.removeAllRanges()}catch(s){console.error(s),u&&u(s)}}function oe(a,o){return(new Date().getTime()-a)/6e4>o}var R=(a=>(a.alert="alert",a.confirm="confirm",a.prompt="prompt",a))(R||{});function I({info:a,type:o,callbackOk:u,callbackCancel:d}){const[s,m]=n.useState(""),C=n.useRef(null),v=n.useRef(null),y=n.useRef(null),t=n.useRef(null),[l,N]=n.useState(void 0),k=n.useCallback(g=>{var T;if(!(g.key!=="Enter"&&g.currentTarget!==C.current)){if(o==="prompt"&&s==="")return(T=y.current)==null?void 0:T.focus();u(s)}},[u,s,o]),S=n.useCallback(g=>{d&&(g.key==="Escape"||g.currentTarget===v.current)&&d()},[d]);return n.useEffect(()=>{var g;return V(),N((g=t.current)==null?void 0:g.clientHeight),document.addEventListener("keydown",S),document.addEventListener("keydown",k),()=>{V(),N(void 0),document.removeEventListener("keydown",S),document.removeEventListener("keydown",k)}},[S,k]),e("div",{role:"dialog",className:"modal dark dialog",children:e("div",{className:"modal-content",ref:t,style:l&&l>130?{"--c-height":l+"px"}:void 0,children:h("div",{className:"modal-body p-10",children:[e("div",{className:"p-tb-10 p-lr-10",children:o==="prompt"?h(F,{children:[e("label",{htmlFor:"promptInput",children:a}),e("input",{type:"number",id:"promptInput",className:"m-t-10",title:"Only numeral(s) are allowed",placeholder:"Enter number of courses",style:{padding:"8px"},ref:y,onInput:g=>m(g.currentTarget.value.trim()),autoFocus:!0})]}):e("p",{children:a})}),h("div",{className:"flex align-items-center justify-content-end flex-wrap m-tb-10 p-lr-10",children:[o!=="alert"&&e("button",{className:"m-r-10",type:"button",ref:v,onClick:S,children:"Cancel"}),e("button",{type:"button",ref:C,onClick:k,autoFocus:o!=="prompt",children:"Ok"})]})]})})})}function ie({clearBodyStyles:a}){const[o,u]=n.useState(null),[d,s]=n.useState(!1),[m,C]=n.useState(!1),[v,y]=n.useState(!1),[t,l]=n.useState(null),[N,k]=n.useState(""),S=n.useRef(null),[g,T]=n.useState(!1),U=n.useRef(3),Y=n.useRef(5),[P,j]=n.useState(null),D=n.useRef(null),[B,A]=n.useState(null),[G,H]=n.useState(!1),[M,E]=n.useState(!1),[$,W]=n.useState(!1);n.useEffect(()=>{a(),l(J())},[a]),n.useEffect(()=>{(!t||t.length<=0)&&(T(!1),A(null))},[t]);const J=()=>{let r=window.localStorage.getItem("courses");return r?JSON.parse(r):null},z=n.useCallback(r=>{if(s(!1),!/^\d+$/.test(r))return setTimeout(()=>u("Please enter a valid numeral."),50);const c=[];for(let f=0;f<parseInt(r);f++)c.push(["",0,40]);const i=(t||[]).concat(c);l(i),window.localStorage.setItem("courses",JSON.stringify(i))},[t]),K=n.useCallback(()=>{C(!1),window.localStorage.removeItem("courses"),l(null)},[]),Q=n.useCallback((r,c)=>{const i=t||J()||[],f=i.findIndex((x,w)=>w===r);f!==-1&&(i[f]=c,window.localStorage.setItem("courses",JSON.stringify(i)),l(i))},[t]),X=n.useCallback(()=>{try{if(y(!1),!t||t.length<=0)throw new Error("Oops, please add course(s) to continue.");const r=[],c=ne(U.current+t.length,P||[]).map(w=>(r.push(w.splice(0,U.current)),w));if(c.length<=0||c.some(w=>w.length!==t.length))throw new Error("Oops, invalid result sheet format.");const i=[],f=[];c.forEach(w=>{const{gradedScores:p,calcScores:b}=ae(w,t);i.push(p),f.push(b)});const x=r.map((w,p)=>w.concat(i[p],f[p]));A(x),setTimeout(()=>{var w;return(w=D.current)==null?void 0:w.scrollIntoView({block:"start"})},50)}catch(r){setTimeout(()=>u(r.message),50)}},[P,t]),Z=n.useCallback(r=>{try{if(r.preventDefault(),A(null),j(null),!/\t/.test(N))throw new Error("Ooops, it appears that result data is not a spreadsheet.");let c=N.split(/(\t|\n)/).map(p=>p.replace(/(\\t|\\n)/g," ")).map(p=>p.trim()).filter(p=>p!=="").reduce((p,b)=>(/^(\d{1,3}[A-F]+)$/i.test(b)&&(b=b.replace(/[A-F]/gi,"")),p.push(b),p),[]);const i=c.findIndex(p=>p.toLowerCase().replace(/\./g,"")==="gpa");if(i===-1)throw new Error("Oops, invalid result data format.");const f=c.splice(0,i+1),x=f.slice(U.current,f.length-Y.current),w=c.splice(0,x.length).map(p=>parseInt(p)).map(p=>isNaN(p)?0:p);if(j(c),!g){l(null);const p=[];for(let L=0;L<x.length;L++)p.push([x[L],w[L],40]);const b=[].concat(p);setTimeout(()=>{l(b),window.localStorage.setItem("courses",JSON.stringify(b))},50)}y(!0)}catch(c){u(c.message)}},[N,g]),ee=async()=>{if("caches"in window&&"serviceWorker"in navigator)try{E(!1),W(!0),V();const r=await caches.keys();await Promise.all(r.map(i=>caches.delete(i))),(await navigator.serviceWorker.getRegistrations()).forEach(async i=>{var f;(f=i.active)!=null&&f.scriptURL.includes("/gpcalc/")&&await i.unregister()}),window.localStorage.removeItem("updateData"),window.location.reload()}catch(r){console.error("Update error:",r)}},te=()=>{const r=window.localStorage.getItem("updateData");return r?JSON.parse(r):null},_=async r=>{let c=null;try{const i=await(await fetch(`./version.json?${new Date().getTime()}`)).json();c={appVersion:i.app,cacheVersion:i.cache,lastCheck:new Date().getTime(),hasUpdate:r!=null&&r.cacheVersion?i.cache>r.cacheVersion:!0},window.localStorage.setItem("updateData",JSON.stringify(c))}catch(i){console.log(i)}return c},q=n.useCallback(async()=>{let r=te()||await _(null);if(r){if(r!=null&&r.hasUpdate){E(!0);return}oe(r.lastCheck,60)&&(r=await _(r),!r)||E(r.hasUpdate)}},[]);return n.useEffect(()=>(window.addEventListener("online",q),()=>{window.removeEventListener("online",q)}),[]),h(F,{children:[e("header",{children:e("nav",{className:"doc-width p-tb-10 p-lr-20 flex justify-content-between align-items-center",children:e("h1",{children:"GPCALC"})})}),e("main",{className:"p-tb-20 main-section",children:h("div",{className:"doc-width p-lr-20",children:[h("div",{className:"m-t-10 p-10 --warning",children:[h("p",{children:[e("strong",{style:{fontSize:"16px"},children:"Note: "}),e("span",{children:"For accuracy and performant calculation, use the following format;"})]}),h("ul",{className:"m-t-10",style:{paddingLeft:"20px"},children:[e("li",{children:"Do not leave any score column empty"}),e("li",{children:"Use EL (ie. elective) in place of score for a course the student does/did not offer"}),e("li",{children:"You can also use NIL in place of 0 (zero)"}),e("li",{children:"Use AB (ie. absent) for an absentee"}),h("li",{children:[e("a",{href:"composite-result-template.xlsx",target:"_blank",rel:"noreferrer",children:"Click here"}),e("span",{children:" to download a sample of a result sheet."})]})]})]}),h("div",{className:"p-tb-10 flex justify-content-end m-t-20",children:[e("button",{className:"p-10 m-r-10",onClick:()=>C(!0),disabled:!(t&&t.length>0),children:"Clear Courses"}),e("button",{className:"p-10",onClick:()=>s(!0),children:"Add Courses"})]}),h("form",{onSubmit:Z,children:[h("div",{className:"p-tb-10",children:[e("h3",{children:"Courses"}),e("div",{className:"flex flex-wrap",children:t?t==null?void 0:t.map((r,c)=>e(re,{data:r,index:c,courseUpdate:Q},c)):e("p",{style:{marginTop:"10px",textAlign:"left"},children:'Course(s) are automatically added, optionally you can use the "Add Courses" button to manually add course(s).'})})]}),e("div",{className:"selector m-t-20",children:h("div",{className:"selector-elems",children:[e("label",{htmlFor:"resultTable",children:e("h3",{children:"Result sheet"})}),h("div",{className:"m-t-10",style:{position:"relative"},children:[N!==""&&e("button",{type:"button",style:{backgroundColor:"rgba(68, 68, 68, 0.4)",color:"#fff",position:"absolute",top:"10px",right:"10px",padding:"5px 10px",border:"none"},onClick:()=>{k(""),S.current&&(S.current.value="")},children:"Clear"}),e("textarea",{className:"p-10",cols:30,rows:10,id:"resultTable",placeholder:"Paste result spreadsheet here",onInput:r=>k(r.currentTarget.value.trim()),ref:S,required:!0})]}),t&&t.length>0&&e("div",{className:"m-t-10",children:h("label",{children:[e("input",{type:"checkbox",className:"m-r-10",onChange:()=>T(!g),checked:g}),e("span",{style:{userSelect:"none"},children:"Use existing added courses"})]})}),e("div",{className:"flex flex-wrap align-items-center --flex",style:{marginTop:"30px"},children:e("button",{type:"submit",className:"p-10 m-r-10",children:"Calculate"})})]})})]}),e("div",{className:"text-center m-t-20 p-tb-20",ref:D,children:B?h(F,{children:[h("div",{className:"flex justify-content-end flex-wrap",children:[e("button",{className:"p-5 p-lr-10",style:{marginRight:"10px"},onClick:()=>{var r;return se((r=D.current)==null?void 0:r.children[1],()=>{H(!0),setTimeout(()=>{H(!1)},3*1e3)},()=>u("Copy command failed, please try using native method."))},disabled:G,children:G?"Copied":"Copy"}),e("button",{className:"p-5 p-lr-10",onClick:()=>A(null),children:"Clear"})]}),e("div",{className:"--result-table-wrap p-tb-10",children:h("table",{children:[h("thead",{children:[h("tr",{children:[e("th",{rowSpan:2,children:"S/N"}),e("th",{rowSpan:2,children:"SCHOLAR’S NAME"}),e("th",{rowSpan:2,children:"MATRIC NO"}),t==null?void 0:t.map((r,c)=>e("th",{children:r[0]},c)),e("th",{rowSpan:2,children:"TOTAL UNITS"}),e("th",{rowSpan:2,children:"UNITS PASSED"}),e("th",{rowSpan:2,children:"CARRY OVER UNITS"}),e("th",{rowSpan:2,children:"GP"}),e("th",{rowSpan:2,children:"GPA"})]}),e("tr",{children:t==null?void 0:t.map((r,c)=>e("th",{children:r[1]},c))})]}),e("tbody",{children:B.map((r,c)=>e("tr",{children:r.map((i,f)=>e("td",{children:i},f))},c))})]})})]}):"Calculated result will appear here..."})]})}),e("footer",{children:h("div",{className:"text-center doc-width p-lr-10",children:[h("span",{children:["©"," "+new Date().getFullYear()+" "]}),e("a",{href:"https://24cipher.com?ref=gpcalc",target:"_blank",rel:"noreferrer",children:"24Cipher Labs"}),e("span",{children:" Software License & Usage."})]})}),d&&e(I,{info:"How many courses do you want to add?",type:R.prompt,callbackOk:z,callbackCancel:()=>s(!1)}),o&&e(I,{info:o,type:R.alert,callbackOk:()=>u(null)}),m&&e(I,{info:"Are you sure you want to clear courses?",type:R.confirm,callbackOk:K,callbackCancel:()=>C(!1)}),v&&e(I,{info:"Do you want to continue without reviewing added courses?",type:R.confirm,callbackOk:X,callbackCancel:()=>y(!1)}),M&&e(I,{info:'Update is available, click "Ok" to continue.',type:R.confirm,callbackOk:ee,callbackCancel:()=>E(!1)}),$&&e("div",{role:"dialog",className:"modal",style:{backgroundColor:"#fff"},children:e("div",{className:"modal-content",children:e("p",{style:{textAlign:"center",padding:"20px"},children:"Downloading update, please wait..."})})})]})}export{ie as default};
